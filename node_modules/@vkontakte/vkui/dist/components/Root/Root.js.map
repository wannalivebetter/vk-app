{"version":3,"sources":["../../../src/components/Root/Root.js"],"names":["baseClassName","Root","props","e","manual","indexOf","animationName","isBack","state","prevView","nextView","setState","activeView","visibleViews","transition","undefined","window","scrollTo","scrolls","onTransition","from","to","arrayChildren","React","Children","toArray","children","nextProps","popout","blurActiveElement","pageYOffset","firstLayerId","find","view","id","prevProps","prevState","prevViewElement","document","getElementById","nextViewElement","querySelector","scrollTop","waitAnimationFinish","onAnimationEnd","elem","eventHandler","transitionEvents","supported","eventName","prefix","removeEventListener","addEventListener","setTimeout","bind","IS_PLATFORM_ANDROID","activeElement","blur","modal","Views","filter","View","map","context","Component","PropTypes","string","isRequired","node","func","any"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from '../../lib/classNames';\nimport getClassName from '../../helpers/getClassName';\n\nimport transitionEvents from '../../lib/transitionEvents';\nimport { IS_PLATFORM_ANDROID } from '../../lib/platform';\n\nconst baseClassName = getClassName('Root');\n\nexport default class Root extends React.Component {\n  constructor (props) {\n    super();\n\n    this.state = {\n      activeView: props.activeView,\n      prevView: null,\n      nextView: null,\n      visibleViews: [props.activeView],\n      isBack: undefined,\n      scrolls: {}\n    };\n\n    this.arrayChildren = React.Children.toArray(props.children);\n  }\n\n  static propTypes = {\n    activeView: PropTypes.string.isRequired,\n    popout: PropTypes.node,\n    modal: PropTypes.node,\n    onTransition: PropTypes.func,\n    children: PropTypes.node\n  };\n\n  static defaultProps = {\n    popout: null\n  };\n\n  static contextTypes = {\n    window: PropTypes.any,\n    document: PropTypes.any\n  };\n\n  get document () {\n    return this.context.document || document;\n  }\n\n  get window () {\n    return this.context.window || window;\n  }\n\n  componentWillReceiveProps (nextProps) {\n    if (nextProps.popout && !this.props.popout) {\n      this.blurActiveElement();\n    }\n\n    if (nextProps.children !== this.props.children) {\n      this.arrayChildren = React.Children.toArray(nextProps.children);\n    }\n\n    if (nextProps.activeView !== this.props.activeView) {\n      let pageYOffset = this.window.pageYOffset;\n      const firstLayerId = this.props.children.find(view => {\n        return view.props.id === this.props.activeView || view.props.id === nextProps.activeView;\n      }).props.id;\n      const isBack = firstLayerId === nextProps.activeView;\n\n      this.blurActiveElement();\n\n      const nextView = nextProps.activeView;\n      const prevView = this.props.activeView;\n\n      this.setState({\n        scrolls: {\n          ...this.state.scrolls,\n          [this.props.activeView]: pageYOffset\n        },\n        transition: true,\n        activeView: null,\n        nextView,\n        prevView,\n        visibleViews: [nextView, prevView],\n        isBack\n      });\n    }\n  }\n\n  componentDidUpdate (prevProps, prevState) {\n    if (!prevState.transition && this.state.transition) {\n      const prevViewElement = this.document.getElementById(`view-${this.state.prevView}`);\n      const nextViewElement = this.document.getElementById(`view-${this.state.nextView}`);\n\n      prevViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.prevView];\n\n      if (this.state.isBack) {\n        nextViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.nextView];\n      }\n      this.waitAnimationFinish(this.state.isBack ? prevViewElement : nextViewElement, this.onAnimationEnd);\n    }\n  }\n\n  waitAnimationFinish (elem, eventHandler) {\n    if (transitionEvents.supported) {\n      const eventName = transitionEvents.prefix ? transitionEvents.prefix + 'AnimationEnd' : 'animationend';\n\n      elem.removeEventListener(eventName, eventHandler);\n      elem.addEventListener(eventName, eventHandler);\n    } else {\n      setTimeout(eventHandler.bind(this), IS_PLATFORM_ANDROID ? 300 : 600);\n    }\n  }\n\n  onAnimationEnd = (e = { manual: true }) => {\n    if ([\n      'root-android-animation-hide-back',\n      'root-android-animation-show-forward',\n      'root-ios-animation-hide-back',\n      'root-ios-animation-show-forward'\n    ].indexOf(e.animationName) > -1 || e.manual) {\n      const isBack = this.state.isBack;\n      const prevView = this.state.prevView;\n      const nextView = this.state.nextView;\n      this.setState({\n        activeView: nextView,\n        prevView: null,\n        nextView: null,\n        visibleViews: [nextView],\n        transition: false,\n        isBack: undefined\n      }, () => {\n        isBack ? this.window.scrollTo(0, this.state.scrolls[this.state.activeView]) : this.window.scrollTo(0, 0);\n        this.props.onTransition && this.props.onTransition({ isBack, from: prevView, to: nextView });\n      });\n    }\n  };\n\n  blurActiveElement () {\n    if (typeof this.window !== 'undefined' && this.document.activeElement) {\n      this.document.activeElement.blur();\n    }\n  }\n\n  render () {\n    const { popout, modal } = this.props;\n    const { transition, isBack, prevView, activeView, nextView } = this.state;\n\n    let Views = this.arrayChildren.filter(View => this.state.visibleViews.indexOf(View.props.id) >= 0);\n\n    return (\n      <div className={ classNames(baseClassName, { 'Root--transition': transition }) }>\n        {Views.map(View => (\n          <div key={View.props.id} id={`view-${View.props.id}`} className={classNames('Root__view', {\n            'Root__view--hide-back': View.props.id === prevView && isBack,\n            'Root__view--hide-forward': View.props.id === prevView && !isBack,\n            'Root__view--show-back': View.props.id === nextView && isBack,\n            'Root__view--show-forward': View.props.id === nextView && !isBack,\n            'Root__view--active': View.props.id === activeView\n          })}>\n            {View}\n          </div>\n        ))}\n        {!!popout && <div className=\"Root__popout\">{popout}</div>}\n        {!!modal && <div className=\"Root__modal\">{modal}</div>}\n      </div>\n    );\n  }\n}\n"],"file":"Root.js"}