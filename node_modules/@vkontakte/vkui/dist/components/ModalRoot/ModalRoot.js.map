{"version":3,"sources":["../../../src/components/ModalRoot/ModalRoot.js"],"names":["baseClassName","TYPE_CARD","TYPE_PAGE","numberInRange","number","range","rangeTranslate","Math","max","min","ModalRootContext","React","createContext","ModalRoot","props","event","originalEvent","preventDefault","e","state","switching","activeModal","nextModal","modalState","modalsState","type","onPageTouchMove","onCardTouchMove","onPageTouchEnd","onCardTouchEnd","target","closest","contentScrolled","clearTimeout","contentScrollStopTimeout","setTimeout","activeTransitions","newState","prevModal","visibleModals","animated","history","setState","triggerActiveModalClose","touchDown","dragging","maskElementRef","createRef","initModalsState","modals","reduce","acc","Modal","modalProps","settlingHeight","onClose","id","initActiveModal","toggleDocumentScrolling","prevProps","prevState","console","warn","isBack","indexOf","splice","push","inited","closeActiveModal","requestAnimationFrame","switchPrevNext","window","document","activeElement","blur","enabled","documentScrolling","removeEventListener","preventTouch","addEventListener","passive","modalId","getElementById","modalElement","pickModal","querySelector","initPageModal","initCardModal","contentElement","contentHeight","firstChild","offsetHeight","isExpandable","clientHeight","innerElement","headerElement","footerElement","collapsed","translateYFrom","translateY","translateYAbs","expandedRange","collapsedRange","hiddenRange","shiftHalf","visiblePart","headerHeight","height","insets","bottom","style","parentNode","prevModalState","waitTransitionFinish","prevNextSwitchEndHandler","animateTranslate","setMaskOpacity","shiftY","startT","isY","stopPropagation","expanded","touchStartTime","touchStartContentScrollTop","scrollTop","touchMovePositive","shiftYPercent","innerHeight","shiftYCurrent","IS_PLATFORM_ANDROID","touchShiftYPercent","translateYCurrent","startY","next","shiftYEndPercent","expectTranslateY","Date","hidden","eventHandler","eventName","transitionEvents","transitionEndEventName","onceHandler","nextModalState","prevIsPage","prevIsCard","nextIsPage","nextIsCard","currentPercent","frameId","cancelAnimationFrame","footerHeight","factor","animatePageHeader","headerOpenPercent","headerShadow","opacity","forceOpacity","maskAnimationFrame","current","activeModalState","webviewType","onTouchMove","onTouchEnd","onScroll","onMaskClick","map","isPage","key","context","concat","children","Component","PropTypes","string","node","object","any","oneOf"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport Touch from '../Touch/Touch';\nimport withInsets from '../../hoc/withInsets';\n\nimport getClassName from '../../helpers/getClassName';\nimport classNames from '../../lib/classNames';\nimport { setTransformStyle } from '../../lib/styles';\nimport { rubber } from '../../lib/touch';\nimport { IS_PLATFORM_ANDROID } from '../../lib/platform';\nimport transitionEvents from '../../lib/transitionEvents';\n\nconst baseClassName = getClassName('ModalRoot');\n\nexport const TYPE_CARD = 'modal-card';\nexport const TYPE_PAGE = 'modal-page';\n\nfunction numberInRange (number, range) {\n  return number >= range[0] && number <= range[1];\n}\n\nfunction rangeTranslate (number) {\n  return Math.max(0, Math.min(98, number));\n}\n\nexport const ModalRootContext = React.createContext(false);\n\nclass ModalRoot extends Component {\n  constructor (props) {\n    super(props);\n\n    this.state = {\n      activeModal: props.activeModal,\n      prevModal: null,\n      nextModal: null,\n      visibleModals: [props.activeModal],\n      animated: false,\n      history: props.activeModal ? [props.activeModal] : [],\n\n      touchDown: false,\n      dragging: false\n    };\n\n    this.activeTransitions = 0;\n    this.maskElementRef = React.createRef();\n\n    this.initModalsState();\n  }\n\n  static propTypes = {\n    activeModal: PropTypes.string,\n    children: PropTypes.node,\n\n    /**\n     * @ignore\n     */\n    insets: PropTypes.object\n  };\n\n  static contextTypes = {\n    window: PropTypes.any,\n    document: PropTypes.any,\n    webviewType: PropTypes.oneOf(['vkapps', 'internal'])\n  };\n\n  get document () {\n    return this.context.document || document;\n  }\n\n  get window () {\n    return this.context.window || window;\n  }\n\n  get webviewType () {\n    return this.context.webviewType || 'vkapps';\n  }\n\n  get modals () {\n    return [].concat(this.props.children);\n  }\n\n  initModalsState () {\n    this.modalsState = this.modals.reduce((acc, Modal) => {\n      const modalProps = Modal.props;\n      const state = {};\n\n      // ModalPage props\n      if (typeof modalProps.settlingHeight === 'number') {\n        state.settlingHeight = modalProps.settlingHeight;\n      }\n\n      state.onClose = Modal.props.onClose;\n      state.id = Modal.props.id;\n      acc[state.id] = state;\n      return acc;\n    }, {});\n  }\n\n  componentDidMount () {\n    this.initActiveModal();\n  }\n\n  componentWillUnmount () {\n    this.toggleDocumentScrolling(true);\n  }\n\n  componentDidUpdate (prevProps, prevState) {\n    if (this.props.activeModal !== prevProps.activeModal && !this.state.switching) {\n      const nextModal = this.props.activeModal;\n      const prevModal = prevProps.activeModal;\n\n      if (nextModal !== null && !this.modalsState[nextModal]) {\n        return console.warn(`[ModalRoot.componentDidUpdate] nextModal ${nextModal} not found`);\n      }\n\n      let history = [...this.state.history];\n      let isBack = false;\n\n      if (nextModal === null) {\n        history = [];\n      } else if (history.indexOf(nextModal) !== -1) {\n        history = history.splice(0, history.indexOf(nextModal) + 1);\n        isBack = true;\n      } else {\n        history.push(nextModal);\n      }\n\n      return this.setState({\n        activeModal: null,\n        nextModal,\n        prevModal,\n        visibleModals: [nextModal, prevModal],\n        history,\n        isBack,\n        animated: true,\n        inited: false,\n        switching: false\n      }, () => {\n        if (nextModal === null) {\n          this.closeActiveModal();\n        } else {\n          this.initActiveModal();\n        }\n      });\n    }\n\n    if (this.state.switching && !prevState.switching) {\n      requestAnimationFrame(() => this.switchPrevNext());\n    }\n\n    if (!this.state.activeModal && !this.state.prevModal && !this.state.nextModal) {\n      this.toggleDocumentScrolling(true);\n    } else {\n      this.toggleDocumentScrolling(false);\n    }\n  }\n\n  blurActiveElement () {\n    if (typeof this.window !== 'undefined' && this.document.activeElement) {\n      this.document.activeElement.blur();\n    }\n  }\n\n  /**\n   * Отключает скролл документа\n   * @param {boolean} enabled Включен ли скроолл\n   */\n  toggleDocumentScrolling (enabled) {\n    if (this.documentScrolling === enabled) return;\n    this.documentScrolling = enabled;\n\n    if (enabled) {\n      this.window.removeEventListener('touchmove', this.preventTouch);\n    } else {\n      this.window.addEventListener('touchmove', this.preventTouch, { passive: false });\n    }\n  }\n\n  preventTouch = (event) => {\n    if (!event) return false;\n    while (event.originalEvent) event = event.originalEvent;\n    event.preventDefault();\n  };\n\n  pickModal (modalId) {\n    return this.document.getElementById('modal-' + modalId);\n  }\n\n  /**\n   * Инициализирует модалку перед анимацией открытия\n   */\n  initActiveModal () {\n    const activeModal = this.state.activeModal || this.state.nextModal;\n    if (!activeModal) return;\n\n    const modalElement = this.pickModal(activeModal);\n    const modalState = this.modalsState[activeModal];\n\n    if (modalElement.querySelector('.ModalPage')) {\n      modalState.type = TYPE_PAGE;\n    } else if (modalElement.querySelector('.ModalCard')) {\n      modalState.type = TYPE_CARD;\n    }\n\n    switch (modalState.type) {\n      case TYPE_PAGE:\n        modalState.settlingHeight = modalState.settlingHeight || 75;\n        this.initPageModal(modalState, modalElement);\n        break;\n\n      case TYPE_CARD:\n        this.initCardModal(modalState, modalElement);\n        break;\n\n      default:\n        console.warn(`[ModalRoot.initActiveModal] modalState.type is unknown`);\n    }\n\n    this.setState({ inited: true, switching: true });\n  }\n\n  initPageModal (modalState, modalElement) {\n    const contentElement = modalElement.querySelector('.ModalPage__content');\n    const contentHeight = contentElement.firstChild.offsetHeight;\n\n    modalState.isExpandable = contentHeight > contentElement.clientHeight;\n\n    modalState.modalElement = modalElement;\n    modalState.innerElement = modalElement.querySelector('.ModalPage__in-wrap');\n    modalState.headerElement = modalElement.querySelector('.ModalPage__header');\n    modalState.contentElement = modalElement.querySelector('.ModalPage__content');\n    modalState.footerElement = modalElement.querySelector('.ModalPage__footer');\n\n    let collapsed;\n    let translateYFrom;\n    let translateY;\n    let translateYAbs;\n    let expandedRange;\n    let collapsedRange;\n    let hiddenRange;\n\n    if (modalState.isExpandable) {\n      translateYFrom = 100 - modalState.settlingHeight;\n\n      const shiftHalf = translateYFrom / 2;\n      const visiblePart = 100 - translateYFrom;\n\n      expandedRange = [0, shiftHalf];\n      collapsedRange = [shiftHalf, translateYFrom + visiblePart / 4];\n      hiddenRange = [translateYFrom + visiblePart / 4, 100];\n\n      collapsed = true;\n      translateY = translateYFrom;\n      translateYAbs = translateYFrom;\n    } else {\n      translateYFrom = 0;\n\n      expandedRange = [0, 25];\n      collapsedRange = [25, 25];\n      hiddenRange = [25, 100];\n\n      collapsed = false;\n      translateY = 0;\n\n      const headerHeight = modalState.headerElement.offsetHeight;\n      modalState.height = contentHeight + headerHeight + (this.props.insets.bottom || 0);\n      modalState.innerElement.style.height = modalState.height + 'px';\n\n      // Абсолютный сдвиг фиксированной страницы\n      translateYAbs = 100 - (modalState.height / modalState.innerElement.parentNode.offsetHeight * 100);\n    }\n\n    modalState.expandedRange = expandedRange;\n    modalState.collapsedRange = collapsedRange;\n    modalState.hiddenRange = hiddenRange;\n    modalState.translateY = translateY;\n    modalState.translateYFrom = translateYFrom;\n    modalState.translateYAbs = translateYAbs;\n    modalState.collapsed = collapsed;\n  }\n\n  initCardModal (modalState, modalElement) {\n    modalState.modalElement = modalElement;\n    modalState.innerElement = modalElement.querySelector('.ModalCard__in');\n\n    modalState.translateY = 0;\n  }\n\n  closeActiveModal () {\n    const { prevModal } = this.state;\n    if (!prevModal) return console.warn(`[ModalRoot.closeActiveModal] prevModal is ${prevModal}`);\n\n    const prevModalState = this.modalsState[prevModal];\n\n    this.waitTransitionFinish(prevModalState, this.prevNextSwitchEndHandler);\n    this.animateTranslate(prevModalState, 100);\n    this.setMaskOpacity(prevModalState, 0);\n  }\n\n  onTouchMove = (e) => {\n    if (this.state.switching) return;\n    const activeModal = this.state.activeModal || this.state.nextModal;\n    if (!activeModal) return;\n\n    const modalState = this.modalsState[activeModal];\n\n    if (modalState.type === TYPE_PAGE) {\n      return this.onPageTouchMove(e, modalState);\n    }\n\n    if (modalState.type === TYPE_CARD) {\n      return this.onCardTouchMove(e, modalState);\n    }\n  };\n\n  onPageTouchMove (event, modalState) {\n    const { shiftY, startT, originalEvent } = event;\n\n    if (!event.isY) {\n      if (originalEvent.target.closest('.ModalPage')) {\n        originalEvent.preventDefault();\n      }\n      return;\n    }\n\n    if (!originalEvent.target.closest('.ModalPage__in')) {\n      return originalEvent.preventDefault();\n    }\n\n    originalEvent.stopPropagation();\n\n    const { isExpandable, contentScrolled, collapsed, expanded } = modalState;\n\n    if (!this.state.touchDown) {\n      modalState.touchStartTime = startT;\n      modalState.touchStartContentScrollTop = modalState.contentElement.scrollTop;\n      this.setState({ touchDown: true });\n    }\n\n    if (contentScrolled) return;\n\n    if (modalState.touchMovePositive === null) {\n      modalState.touchMovePositive = shiftY > 0;\n    }\n\n    if (\n      !modalState.isExpandable ||\n      collapsed ||\n      (expanded && modalState.touchMovePositive && (modalState.touchStartContentScrollTop === 0)) ||\n      originalEvent.target.closest('.ModalPage__header')\n    ) {\n      originalEvent.preventDefault();\n      if (!isExpandable && shiftY < 0) return;\n\n      !this.state.dragging && this.setState({ dragging: true });\n\n      const shiftYPercent = shiftY / this.window.innerHeight * 100;\n      const shiftYCurrent = rubber(shiftYPercent, 72, 0.8, IS_PLATFORM_ANDROID);\n\n      modalState.touchShiftYPercent = shiftYPercent;\n      modalState.translateYCurrent = rangeTranslate(modalState.translateY + shiftYCurrent);\n\n      this.animateTranslate(modalState, modalState.translateYCurrent);\n      this.setMaskOpacity(modalState);\n      return;\n    }\n  }\n\n  onCardTouchMove (event, modalState) {\n    const { originalEvent, shiftY, startT } = event;\n    if (originalEvent.target.closest('.ModalCard__container')) {\n      if (!this.state.touchDown) {\n        modalState.touchStartTime = startT;\n        this.setState({ touchDown: true, dragging: true });\n      }\n\n      const shiftYPercent = shiftY / modalState.innerElement.offsetHeight * 100;\n      const shiftYCurrent = rubber(shiftYPercent, 72, 1.2, IS_PLATFORM_ANDROID);\n\n      modalState.touchShiftYPercent = shiftYPercent;\n      modalState.translateYCurrent = Math.max(0, modalState.translateY + shiftYCurrent);\n\n      this.animateTranslate(modalState, modalState.translateYCurrent);\n      this.setMaskOpacity(modalState);\n    }\n  }\n\n  onTouchEnd = (e) => {\n    const activeModal = this.state.activeModal || this.state.nextModal;\n    if (!activeModal) return;\n    const modalState = this.modalsState[activeModal];\n\n    if (modalState.type === TYPE_PAGE) {\n      return this.onPageTouchEnd(e, modalState);\n    }\n\n    if (modalState.type === TYPE_CARD) {\n      return this.onCardTouchEnd(e, modalState);\n    }\n  };\n\n  onPageTouchEnd (event, modalState) {\n    const { startY, shiftY } = event;\n\n    modalState.contentScrolled = false;\n    modalState.touchMovePositive = null;\n\n    let next;\n\n    if (this.state.dragging) {\n      const shiftYEndPercent = (startY + shiftY) / this.window.innerHeight * 100;\n\n      let translateY = modalState.translateYCurrent;\n      const expectTranslateY = (translateY / (new Date() - modalState.touchStartTime) * 240 * 0.6) * (modalState.touchShiftYPercent < 0 ? -1 : 1);\n      translateY = rangeTranslate(translateY + expectTranslateY);\n\n      if (numberInRange(translateY, modalState.expandedRange)) {\n        translateY = 0;\n      } else if (numberInRange(translateY, modalState.collapsedRange)) {\n        translateY = modalState.translateYFrom;\n      } else if (numberInRange(translateY, modalState.hiddenRange)) {\n        translateY = 100;\n      } else {\n        translateY = modalState.translateYFrom;\n      }\n\n      if (translateY !== 100 && shiftYEndPercent >= 75) {\n        translateY = 100;\n      }\n\n      modalState.translateY = translateY;\n      modalState.translateYCurrent = translateY;\n      modalState.collapsed = translateY > 0 && translateY < shiftYEndPercent;\n      modalState.expanded = translateY === 0;\n      modalState.hidden = translateY === 100;\n\n      if (modalState.hidden) {\n        modalState.onClose();\n      }\n\n      next = () => {\n        !modalState.hidden && this.animateTranslate(modalState);\n        this.setMaskOpacity(modalState);\n      };\n    }\n\n    this.setState({\n      touchDown: false,\n      dragging: false\n    }, next);\n  }\n\n  onCardTouchEnd (event, modalState) {\n    let next;\n\n    if (this.state.dragging) {\n      let translateY = modalState.translateYCurrent;\n\n      const expectTranslateY = (translateY / (new Date() - modalState.touchStartTime) * 240 * 0.6) * (modalState.touchShiftYPercent < 0 ? -1 : 1);\n      translateY = Math.max(0, translateY + expectTranslateY);\n\n      if (translateY >= 30) {\n        translateY = 100;\n      } else {\n        translateY = 0;\n      }\n\n      modalState.translateY = translateY;\n      modalState.hidden = translateY === 100;\n\n      if (modalState.hidden) {\n        modalState.onClose();\n      }\n\n      next = () => {\n        !modalState.hidden && this.animateTranslate(modalState);\n        this.setMaskOpacity(modalState);\n      };\n    }\n\n    this.setState({\n      touchDown: false,\n      dragging: false\n    }, next);\n  }\n\n  onScroll = (e) => {\n    const activeModal = this.state.activeModal;\n\n    if (activeModal && e.target.closest('.ModalPage__content')) {\n      const modalState = this.modalsState[activeModal];\n      modalState.contentScrolled = true;\n\n      clearTimeout(modalState.contentScrollStopTimeout);\n\n      modalState.contentScrollStopTimeout = setTimeout(() => {\n        if (modalState.contentScrolled) {\n          modalState.contentScrolled = false;\n        }\n      }, 250);\n    }\n  };\n\n  waitTransitionFinish (modalState, eventHandler) {\n    const eventName = transitionEvents.transitionEndEventName;\n\n    const onceHandler = () => {\n      modalState.innerElement.removeEventListener(eventName, onceHandler);\n      eventHandler();\n    };\n\n    modalState.innerElement.addEventListener(eventName, onceHandler);\n  }\n\n  switchPrevNext () {\n    const { prevModal, nextModal } = this.state;\n\n    const prevModalState = this.modalsState[prevModal];\n    const nextModalState = this.modalsState[nextModal];\n\n    if (!prevModalState && !nextModalState) {\n      return console.warn(`[ModalRoot.switchPrevNext] prevModal is ${prevModal}, nextModal is ${nextModal}`);\n    }\n\n    const prevIsPage = !!prevModalState && (prevModalState.type === TYPE_PAGE);\n    const prevIsCard = !!prevModalState && (prevModalState.type === TYPE_CARD);\n\n    const nextIsPage = !!nextModalState && (nextModalState.type === TYPE_PAGE);\n    const nextIsCard = !!nextModalState && (nextModalState.type === TYPE_CARD);\n\n    // Ждём полного скрытия предыдущей модалки\n    if (prevModalState && (nextIsCard || (prevIsCard && nextIsPage))) {\n      this.waitTransitionFinish(prevModalState, () => {\n        this.activeTransitions += 1;\n        this.waitTransitionFinish(nextModalState, this.prevNextSwitchEndHandler);\n        this.animateTranslate(nextModalState);\n      });\n\n      return this.animateTranslate(prevModalState, 100);\n    }\n\n    if (prevModalState && nextIsPage) {\n      this.activeTransitions += 1;\n      this.waitTransitionFinish(prevModalState, this.prevNextSwitchEndHandler);\n\n      if (prevIsPage && prevModalState.translateY <= nextModalState.translateYAbs && !this.state.isBack) {\n        this.animateTranslate(prevModalState, nextModalState.translateYAbs + 10);\n      } else {\n        this.animateTranslate(prevModalState, 100);\n      }\n    }\n\n    this.activeTransitions += 1;\n    this.waitTransitionFinish(nextModalState, this.prevNextSwitchEndHandler);\n    this.animateTranslate(nextModalState);\n  }\n\n  prevNextSwitchEndHandler = () => {\n    this.activeTransitions = Math.max(0, this.activeTransitions - 1);\n    if (this.activeTransitions > 0) return;\n\n    const activeModal = this.state.nextModal;\n\n    const newState = {\n      prevModal: null,\n      nextModal: null,\n      visibleModals: [activeModal],\n      activeModal: activeModal,\n      animated: false,\n      switching: false\n    };\n\n    if (!activeModal) {\n      newState.history = [];\n    }\n\n    this.setState(newState);\n  };\n\n  /**\n   * Анимирует сдивг модалки\n   *\n   * @param {object} modalState\n   * @param {number} currentPercent\n   */\n  animateTranslate (modalState, currentPercent = null) {\n    if (currentPercent === null) {\n      currentPercent = modalState.translateY;\n    }\n\n    const frameId = `animateTranslateFrame${modalState.id}`;\n\n    cancelAnimationFrame(this[frameId]);\n    this[frameId] = requestAnimationFrame(() => {\n      setTransformStyle(modalState.innerElement, `translateY(${currentPercent}%)`);\n\n      if (modalState.type === TYPE_PAGE && modalState.footerElement) {\n        const footerHeight = modalState.footerElement.offsetHeight;\n        const factor = modalState.innerElement.offsetHeight * (currentPercent / 100);\n\n        setTransformStyle(modalState.footerElement, `translateY(calc(${footerHeight}px * -${factor / footerHeight}))`);\n      }\n    });\n\n    if (modalState.type === TYPE_PAGE && modalState.isExpandable) {\n      this.animatePageHeader(modalState, currentPercent);\n    }\n  }\n\n  /**\n   * Анимирует тень шапки\n   *\n   * @param {object} modalState\n   * @param {number} currentPercent\n   */\n  animatePageHeader (modalState, currentPercent) {\n    const headerOpenPercent = currentPercent < 15 ? Math.max(0, 15 - currentPercent) / 15 : 0;\n\n    requestAnimationFrame(() => {\n      const headerShadow = modalState.headerElement.querySelector('.ModalPageHeader__shadow');\n      if (headerShadow) {\n        headerShadow.style.opacity = headerOpenPercent;\n      }\n    });\n  }\n\n  /**\n   * Устанавливает прозрачность для полупрозрачной подложки\n   *\n   * @param {object} modalState\n   * @param {number|null} forceOpacity Форсирует установку прозрачности в обход истории\n   */\n  setMaskOpacity (modalState, forceOpacity = null) {\n    if (forceOpacity === null && this.state.history[0] !== modalState.id) return;\n\n    cancelAnimationFrame(this.maskAnimationFrame);\n    this.maskAnimationFrame = requestAnimationFrame(() => {\n      const { translateY, translateYCurrent } = modalState;\n\n      const opacity = forceOpacity === null ? 1 - ((translateYCurrent - translateY) / (100 - translateY)) || 0 : forceOpacity;\n      this.maskElementRef.current.style.opacity = Math.max(0, Math.min(100, opacity));\n    });\n  }\n\n  /**\n   * Закрывает текущую модалку\n   */\n  triggerActiveModalClose () {\n    const activeModalState = this.modalsState[this.state.activeModal];\n    if (activeModalState) {\n      activeModalState.onClose();\n    }\n  }\n\n  /**\n   * По клику на полупрозрачный черный фон нужно закрыть текущую модалку\n   */\n  onMaskClick = () => {\n    if (!this.state.switching) {\n      this.triggerActiveModalClose();\n    }\n  };\n\n  render () {\n    const { prevModal, activeModal, nextModal, visibleModals, animated, touchDown, dragging, switching } = this.state;\n\n    if (!activeModal && !prevModal && !nextModal && !animated) return null;\n\n    return (\n      <ModalRootContext.Provider value={true}>\n        <Touch\n          className={classNames(baseClassName, {\n            'ModalRoot--vkapps': this.webviewType === 'vkapps',\n            'ModalRoot--touched': touchDown,\n            'ModalRoot--switching': switching\n          })}\n          onMove={this.onTouchMove}\n          onEnd={this.onTouchEnd}\n          onScroll={this.onScroll}\n        >\n          <div\n            className=\"ModalRoot__mask\"\n            onClick={this.onMaskClick}\n            ref={this.maskElementRef}\n          />\n          <div className=\"ModalRoot__viewport\">\n            {this.modals.map((Modal) => {\n              const modalId = Modal.props.id;\n              if (visibleModals.indexOf(Modal.props.id) === -1) return null;\n              const modalState = this.modalsState[modalId];\n\n              const isPage = modalState.type === TYPE_PAGE;\n              const key = 'modal-' + modalId;\n\n              return (\n                <div\n                  key={key}\n                  id={key}\n                  className={classNames('ModalRoot__modal', {\n                    'ModalRoot__modal--active': modalId === activeModal,\n                    'ModalRoot__modal--prev': modalId === prevModal,\n                    'ModalRoot__modal--next': modalId === nextModal,\n\n                    'ModalRoot__modal--dragging': dragging,\n\n                    'ModalRoot__modal--expandable': isPage && modalState.isExpandable,\n                    'ModalRoot__modal--expanded': isPage && modalState.expanded,\n                    'ModalRoot__modal--collapsed': isPage && modalState.collapsed\n                  })}\n                >{Modal}</div>\n              );\n            })}\n          </div>\n        </Touch>\n      </ModalRootContext.Provider>\n    );\n  }\n}\n\nexport default withInsets(ModalRoot);\n"],"file":"ModalRoot.js"}